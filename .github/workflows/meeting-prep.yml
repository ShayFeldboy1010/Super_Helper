name: Meeting Prep Check

on:
  schedule:
    # Every 15 min, 06:00-17:00 UTC (08:00-20:00 Israel), Sun-Thu
    - cron: '*/15 6-17 * * 0,1,2,3,4'
  workflow_dispatch:

jobs:
  check-meetings:
    runs-on: ubuntu-latest
    steps:
      - name: Check Upcoming Meetings
        env:
          RENDER_URL: ${{ secrets.RENDER_URL }}
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
        run: |
          if [ -z "$RENDER_URL" ]; then
            echo "RENDER_URL not set, skipping."
            exit 0
          fi

          echo "Checking upcoming meetings..."
          curl -sf -X GET "$RENDER_URL/api/cron/meeting-prep" \
            -H "Authorization: Bearer $CRON_SECRET" \
            -H "Content-Type: application/json" \
            --max-time 30
